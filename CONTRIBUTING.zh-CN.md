# 为 NexusPanel 贡献代码

感谢您对为 NexusPanel 贡献代码的兴趣！本文档提供贡献指南和说明。

## 目录

- [行为准则](#行为准则)
- [如何贡献](#如何贡献)
- [报告问题](#报告问题)
- [提交 Pull Request](#提交-pull-request)
- [开发环境设置](#开发环境设置)
- [代码规范](#代码规范)
- [提交信息规范](#提交信息规范)
- [测试](#测试)
- [文档](#文档)

---

## 行为准则

参与本项目即表示您同意为所有人维护一个尊重和包容的环境。

### 我们的标准

- 保持尊重和体谅
- 欢迎新手并帮助他们学习
- 专注于建设性反馈
- 为错误承担责任
- 优先考虑社区的最佳利益

---

## 如何贡献

为 NexusPanel 贡献有很多方式：

### 1. **报告 Bug**
   - 搜索现有问题以避免重复
   - 使用 bug 报告模板
   - 提供详细的复现步骤
   - 包含系统信息和日志

### 2. **建议功能**
   - 检查功能是否已存在或已计划
   - 使用功能请求模板
   - 解释用例和好处
   - 尽可能提供示例

### 3. **改进文档**
   - 修复拼写错误和不清楚的解释
   - 添加示例和教程
   - 翻译文档
   - 更新过时信息

### 4. **提交代码**
   - 修复 bug
   - 实现新功能
   - 改进性能
   - 重构代码
   - 编写测试

---

## 报告问题

### 提交问题前

1. **搜索现有问题**检查是否已报告
2. **更新到最新版本**查看问题是否仍然存在
3. **收集信息**：
   - NexusPanel 版本
   - 操作系统和版本
   - 浏览器和版本（UI 问题）
   - 复现步骤
   - 预期行为 vs 实际行为
   - 错误消息和日志

### 问题模板

```markdown
**描述**
对问题的清晰描述。

**复现步骤**
1. 转到 '...'
2. 点击 '...'
3. 查看错误

**预期行为**
您期望发生什么。

**实际行为**
实际发生了什么。

**环境**
- NexusPanel 版本: vX.Y.Z
- 操作系统: Ubuntu 22.04 / macOS 13 / Windows 11
- 浏览器: Chrome 120 (如适用)

**日志**
```
在此粘贴相关日志
```

**截图**
如适用，添加截图。

**其他上下文**
任何其他相关信息。
```

---

## 提交 Pull Request

### 开始前

1. **创建或评论问题**讨论您提议的更改
2. **Fork 仓库**到您的 GitHub 账户
3. **创建功能分支**从 `main`：
   ```bash
   git checkout -b feature/your-feature-name
   # 或
   git checkout -b fix/your-bug-fix
   ```

### 进行更改

1. **遵循代码规范**（见下文）
2. **编写清晰、专注的提交**
3. **为新功能或 bug 修复添加测试**
4. **根据需要更新文档**
5. **确保所有测试通过**
6. **运行代码检查和格式化工具**

### 提交您的 PR

1. **推送分支**到您的 fork：
   ```bash
   git push origin feature/your-feature-name
   ```

2. **在 GitHub 上创建 Pull Request**，包含：
   - 概述更改的清晰标题
   - 解释内容和原因的描述
   - 引用相关问题（例如 "Fixes #123"）
   - UI 更改的截图
   - 已完成项目的检查清单

3. **及时、尊重地回应反馈**

### PR 模板

```markdown
**描述**
更改的简要描述。

**相关问题**
修复 #123，相关 #456

**更改类型**
- [ ] Bug 修复（不破坏现有功能的更改）
- [ ] 新功能（不破坏现有功能的更改）
- [ ] 破坏性更改（会导致现有功能发生变化的修复或功能）
- [ ] 文档更新

**检查清单**
- [ ] 我的代码遵循项目的代码规范
- [ ] 我对代码进行了自查
- [ ] 我在必要时注释了代码
- [ ] 我更新了文档
- [ ] 我添加了证明修复/功能有效的测试
- [ ] 所有新测试和现有测试都通过了
- [ ] 我运行了 go fmt 和 go vet（Go 代码）
- [ ] 我运行了 ESLint（前端代码）

**截图**（如适用）
在此添加截图。

**附加说明**
任何附加信息。
```

---

## 开发环境设置

### 前置要求

- **Go**: 1.21 或更高版本
- **Node.js**: 18.x 或更高版本
- **PostgreSQL**: 13+ (或使用 SQLite 进行开发)
- **Git**: 最新版本

### 后端设置

1. **克隆仓库**：
   ```bash
   git clone https://github.com/2670044605/NexusPanel.git
   cd NexusPanel
   ```

2. **安装依赖**：
   ```bash
   go mod download
   ```

3. **设置配置**：
   ```bash
   cp configs/config.example.yaml configs/config.yaml
   # 使用您的设置编辑 config.yaml
   ```

4. **运行数据库迁移**：
   ```bash
   # 迁移在首次启动时自动运行
   ```

5. **构建和运行**：
   ```bash
   make build
   ./bin/nexuspanel-server
   # 或
   make run
   ```

### 前端设置

1. **导航到 web 目录**：
   ```bash
   cd web
   ```

2. **安装依赖**：
   ```bash
   npm install
   ```

3. **运行开发服务器**：
   ```bash
   npm run dev
   ```

4. **生产构建**：
   ```bash
   npm run build
   ```

### 运行测试

**后端测试**：
```bash
go test ./...
go test -race ./...  # 带竞态检测器
go test -cover ./... # 带覆盖率
```

**前端测试**：
```bash
cd web
npm run test
npm run test:coverage
```

---

## 代码规范

### Go 代码

1. **遵循 Go 惯例**：
   - 使用 `gofmt` 格式化代码
   - 使用 `go vet` 检查问题
   - 遵循 [Effective Go](https://golang.org/doc/effective_go.html)

2. **命名规范**：
   - 私有函数/变量使用 `camelCase`
   - 导出函数/类型使用 `PascalCase`
   - 使用有意义的描述性名称

3. **注释**：
   - 添加包文档
   - 为所有导出的函数/类型添加文档
   - 使用完整的句子
   - 以被文档化的名称开始

4. **错误处理**：
   - 始终检查和处理错误
   - 在错误消息中提供上下文
   - 使用带 `%w` 的 `fmt.Errorf` 包装错误

5. **项目结构**：
   - `internal/` 用于私有代码
   - `pkg/` 用于可复用库
   - 遵循清洁架构原则

### TypeScript/Vue 代码

1. **使用 TypeScript** 实现类型安全
2. **遵循 Vue 3 Composition API** 最佳实践
3. **使用 ESLint** 和 Prettier 保持一致性：
   ```bash
   npm run lint
   npm run format
   ```

4. **组件结构**：
   - 使用 `<script setup>` 语法
   - 用 TypeScript 定义 props
   - 将可复用逻辑提取到 composables

5. **命名规范**：
   - 组件使用 `PascalCase`
   - 函数/变量使用 `camelCase`
   - 文件名使用 `kebab-case`

### 通用原则

- **KISS**: 保持简单
- **DRY**: 不要重复自己
- **YAGNI**: 你不会需要它
- **编写自文档化代码**
- **可读性优于巧妙性**
- **测试您的代码**

---

## 提交信息规范

我们遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范。

### 格式

```
<类型>(<范围>): <主题>

<正文>

<页脚>
```

### 类型

- **feat**: 新功能
- **fix**: Bug 修复
- **docs**: 文档更改
- **style**: 代码样式更改（格式化等）
- **refactor**: 代码重构
- **perf**: 性能改进
- **test**: 添加或更新测试
- **chore**: 维护任务
- **ci**: CI/CD 更改

### 示例

```
feat(auth): 添加 JWT 令牌刷新机制

实现自动令牌刷新以改善用户体验并减少登录提示。

Fixes #123
```

```
fix(server): 修复监控指标收集器中的内存泄漏

指标收集器未正确关闭 SSH 连接，导致内存随时间累积。

Closes #456
```

```
docs(api): 更新认证端点示例

添加更多示例并阐明令牌过期行为。
```

### 指南

- 使用祈使语气（"添加"而不是"已添加"）
- 主题首字母不大写
- 主题末尾不加句号
- 主题行限制在 50 个字符
- 正文每行限制在 72 个字符
- 在页脚中引用问题

---

## 测试

### 编写测试

1. **单元测试**: 测试单个函数/方法
2. **集成测试**: 测试组件交互
3. **E2E 测试**: 测试完整的用户工作流

### 测试指南

- **尽可能先编写测试**（TDD）
- **测试边缘情况**和错误条件
- **保持测试专注**和独立
- **使用描述性测试名称**
- **模拟外部依赖**
- **追求高覆盖率** (>80%)

### 运行测试

```bash
# 后端测试
make test

# 前端测试
cd web && npm run test

# 集成测试
make test-integration

# 所有测试
make test-all
```

---

## 文档

### 需要文档化的内容

- **代码**: 函数、类型、复杂逻辑
- **API**: 端点、参数、响应
- **功能**: 如何使用新功能
- **设置**: 安装和配置
- **架构**: 系统设计决策

### 文档指南

1. **随代码更改保持更新**
2. **使用清晰、简单的语言**
3. **在有帮助的地方提供示例**
4. **为复杂概念包含图表**
5. **支持多语言**（英文和中文）

### 文档文件

- `README.md` - 项目概览和快速开始
- `docs/en-US/` - 英文文档
- `docs/zh-CN/` - 中文文档
- 代码注释 - 内联文档

---

## 有问题？

如果您有问题或需要帮助：

1. 检查现有文档
2. 搜索已关闭的问题
3. 使用问题标签打开新问题
4. 加入我们的社区讨论（如果可用）

---

## 许可证

通过为 NexusPanel 贡献代码，您同意您的贡献将根据 AGPL-3.0 许可证授权。

---

**感谢您为 NexusPanel 贡献代码！**
